helm upgrade cilium --install cilium/cilium \
    --atomic \
    --set config.ipam=kubernetes \
    --set global.bpf.monitorAggregation=maximum \
    --set global.bpf.preallocateMaps=true \
    --set global.bpf.waitForMount=true \
    --set global.cleanBpfState=true \
    --set global.cleanState=true \
    --set global.cluster.name=k3s \
    --set global.containerRuntime.integration="containerd" \
    --set global.containerRuntime.socketPath="/var/run/k3s/containerd/containerd.sock" \
    --set global.debug.enabled=true \
    --set global.device=eth0 \
    --set global.externalIPs.enabled=true \
    --set global.hostPort.enabled=true \
    --set global.hostServices.enabled=true \
    --set global.hubble.enabled=true \
    --set global.hubble.metrics.enabled="{dns,drop,tcp,flow,port-distribution,icmp,http}" \
    --set global.hubble.relay.enabled=true \
    --set global.hubble.ui.enabled=true \
    --set global.k8s.requireIPv4PodCIDR=true \
    --set global.k8sServiceHost=192.168.1.109 \
    --set global.k8sServicePort=${API_SERVER_PORT:-6443} \
    --set global.kubeProxyReplacement=strict \
    --set global.nodePort.enabled=true \
    --set global.nodePort.mode=hybrid \
    --set global.operatorPrometheus.enabled=true \
    --set global.prometheus.enabled=true \
    --set global.psp.enabled=true \
    --set global.tunnel=geneve \
    --set operator.numReplicas=1 \
    --version ${CILIUM:-1.8.4} \
    -n kube-system \
    -v 3
